# 分析数据丢失的原因
分析RabbitMQ消息丢失的情况，不妨先看看一条消息从生产者发送到消费者消费的过程：


可以看出，一条消息整个过程要经历两次的网络传输：从生产者发送到RabbitMQ服务器，从

**RabbitMQ服务器发送到消费者。
在消费者未消费前存储在队列(Queue)中。**

所以可以知道，有三个场景下是会发生消息丢失的：

- 存储在队列中，如果队列没有对消息持久化，RabbitMQ服务器宕机重启会丢失数据。
- 生产者发送消息到RabbitMQ服务器过程中，RabbitMQ服务器如果宕机停止服务，消息会丢失。
- 消费者从RabbitMQ服务器获取队列中存储的数据消费，但是消费者程序出错或者宕机而没有正确消费，导致数据丢失。

针对以上三种场景，RabbitMQ提供了三种解决的方式，分别是消息持久化，confirm机制，ACK事务机制。
二、消息持久化
RabbitMQ是支持消息持久化的，消息持久化需要设置：Exchange为持久化和Queue持久化，这样当消息发送到RabbitMQ服务器时，消息就会持久化。
首先看Exchange交换机的类图：

# 1.生产者丢失数据?

## confirm机制
